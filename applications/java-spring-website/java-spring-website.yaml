#
#   This application file defines how to deploy and configure
#   a sample website.
#   Developed with Java Spring, deployed on a TomCat web server
#
---
spec_version: 1
kind: application

# These inputs are used by the initialization script,
# to configure the connectivity to the database
# In our use case, the value will be provided from the Blueprint
# using this application
inputs:
  - DB_USER
  - DB_PASS
  - DB_NAME

# We define the connectivity requirements and used ports
infrastructure:
  connectivity:
    external:
      - port_info:
          path: ''
          # Port 8080 will be opened externally to receive web requests
          port: 8080

source:
  os_type: linux
  # Images for AWS are provided per region
  image:
    # This is a clean Ubuntu server image that will be used
    # to create a new EC2 instance in the defined AWS region
    ami:
      - id: ami-f90a4880
        region: eu-west-1

configuration:
  # The initialization script is intended to install
  # app prerequisite and initialize the OS
  initialization:
    script: java-spring-website.sh
  # The start script contains the commands
  # needed to start the application process
  start:
    command: >
      systemctl restart tomcat8
  # We validate the app is listening on
  # the ports defined in the connectivity section
  # to validate it is up
  healthcheck:
    wait_for_ports: ALL
    timeout: 180
